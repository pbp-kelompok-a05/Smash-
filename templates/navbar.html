{% extends 'base.html' %}
{% load static %}
<nav class="navbar">
  <div class="navbar-left">
    <!-- Tombol sidebar -->
    <button class="menu-btn" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Logo -->
    <a href="/" class="navbar-logo">
      <img src="{% static 'static/images/logo-smash.png' %}" alt="Logo">
      <span class="logo-text">Smash!</span>
    </a>
  </div>

  <!-- Kolom pencarian -->
  <div class="navbar-search">
  <form id="searchForm" action="{% url 'search_posts' %}" method="GET" style="display:flex;align-items:center;width:100%;">
    <i class="fas fa-search"></i>
    <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}" required>
  </form>
  </div>

  <!-- Bagian kanan -->
  <div class="navbar-right">
    {% if user.is_authenticated %}
      <!-- Tombol create post -->
      <a href="{% url 'create_post' %}" class="create-post-btn desktop-only">
        <i class="fas fa-plus"></i> Create a post
      <!-- Tombol create post -->
      <a href="{% url 'create_post' %}" class="create-post-btn desktop-only">
        <i class="fas fa-plus"></i> Create a post
      </a>
      <a href="{% url 'create_post' %}" class="create-post-btn mobile-only" title="Create Post">
        <i class="fas fa-plus"></i>
      </a>

      <!-- Menu user -->
      <div class="user-menu">
        <img 
          src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
          alt="User Avatar" 
          class="user-avatar"
        >
        <span class="username">{{ user.username }}</span>
        <i class="fas fa-chevron-down dropdown-toggle"></i>
        <ul class="dropdown-menu">
          <li>
            <form id="logout-form" method="POST" action="{% url 'logout_ajax' %}">
              {% csrf_token %}
              <button type="submit" class="logout-btn">Logout</button>
            </form>
          </li>
        </ul>
      <a href="{% url 'create_post' %}" class="create-post-btn mobile-only" title="Create Post">
        <i class="fas fa-plus"></i>
      </a>

      <!-- Menu user -->
      <div class="user-menu">
        <img 
          src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" 
          alt="User Avatar" 
          class="user-avatar"
        >
        <span class="username">{{ user.username }}</span>
        <i class="fas fa-chevron-down dropdown-toggle"></i>
        <ul class="dropdown-menu">
          <li>
            <form id="logout-form" method="POST" action="{% url 'logout_ajax' %}">
              {% csrf_token %}
              <button type="submit" class="logout-btn">Logout</button>
            </form>
          </li>
        </ul>
      </div>
    {% else %}
      <!-- Bila belum login -->
      <a href="{% url 'login_register' %}" class="auth-btn register-btn">
        <i class="fas fa-user-plus"></i> Register
      <!-- Bila belum login -->
      <a href="{% url 'login_register' %}" class="auth-btn register-btn">
        <i class="fas fa-user-plus"></i> Register
      </a>
      <a href="{% url 'login_register' %}" class="auth-btn login-btn">Login</a>
      <a href="{% url 'login_register' %}" class="auth-btn login-btn">Login</a>
    {% endif %}
  </div>
</nav>

<style>
/* ===== Struktur utama ===== */
.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 20px;
  background: #fff;
  border-bottom: 1px solid #eee;
  position: sticky;
  top: 0;
  z-index: 1000;
}

.navbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.menu-btn {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #444;
}

.navbar-logo {
  display: flex;
  align-items: center;
  text-decoration: none;
  color: #4b006e;
  font-weight: 700;
  font-size: 20px;
}

.navbar-logo img {
  height: 36px;
  margin-right: 6px;
}

/* ===== Kolom pencarian ===== */
.navbar-search {
  flex: 1;
  display: flex;
  align-items: center;
  background: #f3f3f3;
  border-radius: 8px;
  padding: 6px 10px;
  margin: 0 20px;
}

.navbar-search i {
  color: #888;
  margin-right: 6px;
}

.navbar-search input {
  border: none;
  background: transparent;
  outline: none;
  width: 100%;
}

/* ===== Bagian kanan ===== */
.navbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.create-post-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #007bff;
  color: white;
  font-weight: 600;
  padding: 6px 14px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
}

.create-post-btn i {
  margin-right: 6px;
}

.create-post-btn.mobile-only {
  display: none;
}

/* Menu user */
.user-menu {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
}

.username {
  font-weight: 500;
}

.dropdown-toggle {
  font-size: 12px;
  color: #555;
}

.dropdown-menu {
  position: absolute;
  right: 0;
  top: 120%;
  background: white;
  border: 1px solid #eee;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  display: none;
  list-style: none;
  padding: 8px 0;
}

.user-menu:hover .dropdown-menu {
  display: block;
}

.dropdown-menu li {
  padding: 0;
}

.logout-btn {
  background: none;
  border: none;
  padding: 10px 20px;
  width: 100%;
  text-align: left;
  cursor: pointer;
  color: #333;
}

/* ===== Responsif ===== */
@media (max-width: 768px) {
  .navbar {
    padding: 8px 12px;
  }

  .navbar-search {
    margin: 0 10px;
  }

  .create-post-btn.desktop-only {
    display: none;
  }

  .create-post-btn.mobile-only {
    display: flex;
    width: 36px;
    height: 36px;
    justify-content: center;
    align-items: center;
    border-radius: 8px; /* sedikit melengkung */
    font-size: 18px;
  }

  .username {
    display: none;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const logoutForm = document.querySelector("#logout-form");
  if (logoutForm) {
    logoutForm.addEventListener("submit", async function(e) {
      e.preventDefault();
      const res = await fetch("{% url 'logout_ajax' %}", {
        method: "POST",
        headers: {"X-CSRFToken": "{{ csrf_token }}"},
      });
      const data = await res.json();
      if (data.success) location.reload();
    });
  }
});

// === Toggle Sidebar dari Navbar ===
document.addEventListener("DOMContentLoaded", function() {
  const toggleBtn = document.getElementById("sidebarToggle");
  const sidebar = document.getElementById("sidebar");

  if (toggleBtn && sidebar) {
    toggleBtn.addEventListener("click", function() {
      sidebar.classList.toggle("open");
    });
  }
});

// === Fungsi pencarian ===
document.addEventListener("DOMContentLoaded", function() {
  const searchForm = document.getElementById("searchForm");
  if (searchForm) {
    searchForm.addEventListener("submit", function(e) {
      const input = searchForm.querySelector("input[name='q']");
      if (!input.value.trim()) {
        e.preventDefault(); // Cegah submit kosong
        alert("Ketik sesuatu untuk mencari post atau thread.");
      }
    });
  }
});
</script>