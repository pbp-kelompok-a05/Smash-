{% load static %}

<nav
  class="bg-white shadow-sm w-full fixed top-0 left-0 z-50 flex items-center justify-between px-4 py-2"
>
  <!-- Left: Menu icon -->
  <button
    id="menu-btn"
    class="p-2 hover:bg-gray-100 rounded-full"
    onclick="toggleSidebar()"
    type="button"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M4 6h16M4 12h16M4 18h16"
      />
    </svg>
  </button>

  <!-- Middle: Logo + Search -->
  <div class="flex items-center gap-4 flex-1 mx-4">
    <a href="/" class="flex items-center gap-2">
      <img src="{% static 'static/images/logo-smash.png' %}" alt="Smash Logo" class="h-8 w-auto" />
      <span class="font-bold text-xl text-purple-700">Smash!</span>
    </a>

    <div class="flex-1 hidden sm:block">
      <input
        type="text"
        placeholder="Search..."
        class="w-full rounded-lg border px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-purple-300"
      />
    </div>
  </div>

  <!-- Right Section -->
  <div class="flex items-center gap-3">
    {% if user.is_authenticated %}
      <!-- Tombol Create Post menggunakan -->
      <a
        href="{% url 'create_forum_post' %}"
        class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 inline-flex items-center"
      >
        Create a Post
      </a>

      <!-- Dropdown user -->
      <div class="relative">
        <button
          id="user-btn"
          class="flex items-center gap-2 border rounded-full px-3 py-1 hover:bg-gray-100"
          onclick="toggleDropdown()"
          type="button"
        >
          <!-- Avatar user (fallback ke default jika tidak ada) -->
          <img
            src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}"
            alt="User Avatar"
            class="h-6 w-6 rounded-full object-cover"
          />
          <span class="text-sm font-medium">{{ user.username }}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <!-- Dropdown menu -->
        <div
          id="dropdown"
          class="hidden absolute right-0 mt-2 w-40 bg-white border rounded-lg shadow-lg"
        >
          <a
            href="{% url 'my_posts' %}"
            class="block px-3 py-2 text-sm hover:bg-gray-100"
          >
            üìù My Posts
          </a>

          <button
            id="logout-btn"
            class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100"
            type="button"
          >
            üö™ Logout
          </button>
        </div>
      </div>
    {% else %}
      <a
        href="{% url 'login_register' %}"
        class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 inline-flex items-center"
      >
        Register
      </a>
      <a
        href="{% url 'login_register' %}"
        class="px-3 py-1 text-sm border rounded hover:bg-gray-100 inline-flex items-center"
      >
        Login
      </a>
    {% endif %}
  </div>
</nav>

<script>
  function toggleDropdown() {
    document.getElementById("dropdown")?.classList.toggle("hidden");
  }

  function toggleSidebar() {
    console.log("Sidebar toggle triggered");
  }

  document.addEventListener("DOMContentLoaded", function () {
    const logoutBtn = document.getElementById("logout-btn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async function () {
        const csrftoken = getCookie("csrftoken");
        const res = await fetch("{% url 'logout_ajax' %}", {
          method: "POST",
          headers: { "X-CSRFToken": csrftoken },
        });
        try {
          const data = await res.json();
          if (data.success) {
            location.reload();
          } else {
            alert("Logout failed.");
          }
        } catch (err) {
          console.error(err);
          alert("Logout error.");
        }
      });
    }
  });

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>